<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> python json解析那点事</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="description" content="Linux. Python. Coder. Gopher.">
    <meta name="author" content="kosmgco">

    <link href="/theme/css/fonts.css" rel="stylesheet" />

    <link href="/theme/css/normalize.css" rel="stylesheet"/>
    <link href="/theme/css/skeleton.css" rel="stylesheet"/>
    <link href="/theme/css/github-prettify-theme.css" rel="stylesheet"/>
    <link href="/theme/css/custom.css" rel="stylesheet"/>
    <link href="/theme/css/pygement.css" rel="stylesheet"/>

    <script src="/theme/js/jquery.min.js"></script>
    <script src="/theme/js/run_prettify.js"></script>
    <script src="/theme/js/site.js"></script>
</head>
<body class="code-snippets-visible">

<div class="navbar-spacer"></div>
<nav class="navbar">
    <div class="container">
        <ul class="navbar-list">
            <li class="navbar-item">
                <a class="navbar-link" href="/">
                    HOME
                </a>
            </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/books.html">
                        books
                    </a>
                </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/theme.html">
                        theme
                    </a>
                </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/blog.html">
                        blog
                    </a>
                </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/about.html">
                        about
                    </a>
                </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/wiki.html">
                        wiki
                    </a>
                </li>
        </ul>
        <div class="navbar-link">
            <a href="/"><img src="/theme/images/avatar.jpg" class="site-icon"/></a>
        </div>
    </div>
</nav>
<div class="container">
    <section id="content">
        <article>
            <p class="article-date">
                2015-12-18 20:22:39+08:00
            </p>
            <header class="header">
                <a href="/python-jsonjie-xi-na-dian-shi.html" rel="bookmark" title="Permalink to python json解析那点事">
                    <h2 class="blogpost-title">
                        python json解析那点事
                    </h2>
                </a>
            </header>
            <div>
                <hr />
<p>今天做了个<code>json</code>解析的模块，原因是为了得到一个网站的数据，通过post方式。返回数据的格式如下:</p>
<!-- more -->

<div class="highlight"><pre><span></span><span class="s2">&quot;[{</span><span class="se">\&quot;</span><span class="s2">Count</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">2535773</span><span class="se">\&quot;</span><span class="s2">},{</span><span class="se">\&quot;</span><span class="s2">裁判要旨段原文</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">本院认为，被....</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">DocContent</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">人民陪审员</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">案件类型</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">1</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">裁判日期</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">2015-06-18</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">案件名称</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">被告人</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">文书ID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">ffaf4515-b185-46d4-a306-6f6386d20002</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">审判程序</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">一审</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">案号</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">（2015）扶刑初字第</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">法院名称</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">吉林省扶</span><span class="se">\&quot;</span><span class="s2">},{</span><span class="se">\&quot;</span><span class="s2">裁判要旨段原文</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">如下</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">DocContent</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">起计算。</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">案件类型</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">1</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">裁判日期</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">2015-10-29</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">案件名称</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">姜某犯</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">文书ID</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">bf80393d-359a-4e80-bf8a-1c2a8ed7df33</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">审判程序</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">一审</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">案号</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">（2015）淮刑初字第00512号</span><span class="se">\&quot;</span><span class="s2">,</span><span class="se">\&quot;</span><span class="s2">法院名称</span><span class="se">\&quot;</span><span class="s2">:</span><span class="se">\&quot;</span><span class="s2">江江苏省淮安市淮阴区人民法院</span><span class="se">\&quot;</span><span class="s2">}]&quot;</span>
</pre></div>


<p>很明显，这并不是<code>json module</code>能够解析的了的，里面的引号都是转义的，报错<code>value</code>也有很多引号都是转义的<code>\"</code>，这给解析带来了很多麻烦。</p>
<p>首先我想的是:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">jsstr</span> <span class="o">=</span> <span class="s1">&#39;上面那一段&#39;</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">subn</span><span class="p">(</span><span class="s1">r&#39;</span><span class="se">\\</span><span class="s1">\&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">jsstr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">jsonstr</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecoder</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</pre></div>


<p>但是报错了，原因是<code>value</code>里面就有<code>对"XX事实"供认不讳</code>这样的语句，所以就把<code>value</code>分成了几段，就像<code>sql</code>注入那样，所以不能解析成功。</p>
<p>没办法了，只能把那些个比较特殊的分别替换出来。</p>
<p>于是替换后的结果为:</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&quot;Count&quot;</span><span class="p">:</span><span class="s2">&quot;2535773&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;裁判要旨段原文&quot;</span><span class="p">:</span><span class="s2">&quot;本院认为，被....&quot;</span><span class="p">,</span>
        <span class="nt">&quot;DocContent&quot;</span><span class="p">:</span><span class="s2">&quot;人民陪审员&quot;</span><span class="p">,</span>
        <span class="nt">&quot;案件类型&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;裁判日期&quot;</span><span class="p">:</span><span class="s2">&quot;2015-06-18&quot;</span><span class="p">,</span>
        <span class="nt">&quot;案件名称&quot;</span><span class="p">:</span><span class="s2">&quot;被告人&quot;</span><span class="p">,</span>
        <span class="nt">&quot;文书ID&quot;</span><span class="p">:</span><span class="s2">&quot;ffaf4515-b185-46d4-a306-6f6386d20002&quot;</span><span class="p">,</span>
        <span class="nt">&quot;审判程序&quot;</span><span class="p">:</span><span class="s2">&quot;一审&quot;</span><span class="p">,</span>
        <span class="nt">&quot;案号&quot;</span><span class="p">:</span><span class="s2">&quot;（2015）扶刑初字第&quot;</span><span class="p">,</span>
        <span class="nt">&quot;法院名称&quot;</span><span class="p">:</span><span class="s2">&quot;吉林省扶&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="nt">&quot;裁判要旨段原文&quot;</span><span class="p">:</span><span class="s2">&quot;如下&quot;</span><span class="p">,</span>
        <span class="nt">&quot;DocContent&quot;</span><span class="p">:</span><span class="s2">&quot;起计算。&quot;</span><span class="p">,</span>
        <span class="nt">&quot;案件类型&quot;</span><span class="p">:</span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;裁判日期&quot;</span><span class="p">:</span><span class="s2">&quot;2015-10-29&quot;</span><span class="p">,</span>
        <span class="nt">&quot;案件名称&quot;</span><span class="p">:</span><span class="s2">&quot;姜某犯&quot;</span><span class="p">,</span>
        <span class="nt">&quot;文书ID&quot;</span><span class="p">:</span><span class="s2">&quot;bf80393d-359a-4e80-bf8a-1c2a8ed7df33&quot;</span><span class="p">,</span>
        <span class="nt">&quot;审判程序&quot;</span><span class="p">:</span><span class="s2">&quot;一审&quot;</span><span class="p">,</span>
        <span class="nt">&quot;案号&quot;</span><span class="p">:</span><span class="s2">&quot;（2015）淮刑初字第005号&quot;</span><span class="p">,</span>
        <span class="nt">&quot;法院名称&quot;</span><span class="p">:</span><span class="s2">&quot;江苏&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>


<p>现在使用<code>jobj = json.JSONDecoder().decode(jsonstr)</code>就能得到一个<code>dict</code>类型的对象了。</p>
<p>但是现在得到了一个比较复杂的json串：</p>
<div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="nt">&quot;北京&quot;</span><span class="p">:{</span>
            <span class="nt">&quot;北京市第一中级人民法院&quot;</span><span class="p">:[</span>
                <span class="s2">&quot;北京市石景山区人民法院&quot;</span><span class="p">,</span>
                <span class="s2">&quot;北京市海淀区人民法院&quot;</span><span class="p">,</span>
                <span class="s2">&quot;....&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;北京市第二中级人民法院&quot;</span><span class="p">:[</span>
                <span class="s2">&quot;北京市东城区人民法院&quot;</span><span class="p">,</span>
                <span class="s2">&quot;北京市西城区人民法院&quot;</span><span class="p">,</span>
                <span class="s2">&quot;....&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;河北&quot;</span><span class="p">:{</span>
            <span class="nt">&quot;河北省石家庄市中级人民法院&quot;</span><span class="p">:[</span>
                <span class="s2">&quot;石家庄市长安区人民法院&quot;</span><span class="p">,</span>
                <span class="s2">&quot;石家庄市桥西区人民法院&quot;</span><span class="p">,</span>
                <span class="s2">&quot;....&quot;</span>
            <span class="p">],</span>
            <span class="nt">&quot;河北省秦皇岛市中级人民法院&quot;</span><span class="p">:[</span>
                <span class="s2">&quot;秦皇岛市海港区人民法院&quot;</span><span class="p">,</span>
                <span class="s2">&quot;秦皇岛市北戴河区人民法院&quot;</span><span class="p">,</span>
                <span class="s2">&quot;....&quot;</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="nt">&quot;.....&quot;</span><span class="p">:{}</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>


<p>虽然以前使用<code>C#</code>的时候也解析过比较复杂的<code>json</code>串，但是<code>C#</code>使用<code>Newtonsoft.net</code>可以直接反序列化成结构化的对象。<code>python</code>只能解析成<code>dict</code>类型的对象。使用<code>jobj = json.JSONDecoder().decode(str)</code>得到类型为<code>dict</code>的<code>jobj</code>。但是我想得到<code>value</code>怎么办呢？只有遍历了，照这样子，算法复杂度可不低啊。</p>
<p>至少两个循环，那算法的复杂度至少为<code>O(n^2)</code>了，虽然代码不多，但是我也不想这样做。</p>
<p>如果有好的解决方案，请留言告诉我。</p>
            </div>
            <div class="article-info">
                <hr/>
                <div class="article-info">
                    <span><b>Category: </b><a href="/category/python.html">python</a></span>
                    <br/>
                    <span><b>Publication Date: </b> Fri 18 December 2015 </span>
                    <br/>
                        <a class="label-default" href="/tag/python.html">python</a>
                        <a class="label-default" href="/tag/json.html">json</a>
                    <br/>
                </div>
            </div>
        </article>
    </section>
        <br/><br/><br/><br/>
</div>

<footer class="footer">
    &copy <a href="/" >kosmgco</a>. 2016
    <br/>
    Powered by <a href="http://getpelican.com/">pelican</a>.
    Theme by <a href="http://github.com/liyuan-t/ops">ops</a>
    <br/>
</footer>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?67d2b3355046511d3ad9eef9c65d2a41";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
    })();
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
var duoshuoQuery = {short_name:"liyuan-t"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
<!-- 多说公共JS代码 end -->
</script>
</body>
</html>