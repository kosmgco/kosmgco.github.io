<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>  Kosmgco | 关于刷票 </title>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<link href="https://blog.ooops.me/theme/css/github-markdown.css" rel="stylesheet"/>
<link href="https://blog.ooops.me/theme/css/custom.css" rel="stylesheet"/>
<meta name="baidu-site-verification" content="qfSD7JIuUr"/>
<meta name="description" content="Linux. Python. Coder. Gopher."/>
<meta name="author" content="kosmgco" />

<meta name="viewport" content="width=device-width, initaial-scale=1"/>  </head>
  <body class="markdown-body">
    <style>
      @media (max-width: 550px) {
        .catalog, .content {
          display:none;
        }
      }
    </style>
    <div class="menu">
      <div class="title" style="background: url(https://static.ooops.me/md-upload-1536468495519.png) no-repeat; background-position: center"></div>
      <h3> Kosmgco </h3>
      <h4> Linux. Python. Coder. Gopher. </h4>
      <div class="links-menu" >
        <a href="https://blog.ooops.me/" class="menu-link" title="HOME"><img src="/theme/images/home.png" width="40"/></a>
        <a href="https://blog.ooops.me/tags.html" class="menu-link" title="TAGS"><img src="/theme/images/tags.png" width="40"/></a>
        <a href="https://blog.ooops.me/categories.html" class="menu-link" title="CATEGORIES"><img src="/theme/images/categories.png" width="40"/></a>
        <a href="https://blog.ooops.me/pages/about.html" class="menu-link" title="ABOUT"><img src="/theme/images/about.png" width="40"/></a>
        <a href="https://blog.ooops.me/pages/wiki.html" class="menu-link" title="WIKI"><img src="/theme/images/wiki.png" width="40"/></a>
        <a href="https://blog.ooops.me/pages/blog.html" class="menu-link" title="BLOG"><img src="/theme/images/blog.png" width="40"/></a>
 
      </div>
      <div class="links">
        <a href="http://github.com/kosmgco" target="_blank">
          <img src="https://blog.ooops.me/theme/images/github-128.png" style="width:32px;">
        </a>
        <a href="mailto:i@ooops.me" target="_blank">
          <img src="https://blog.ooops.me/theme/images/mail-128.png" style="width:32px;">
        </a>
        <a href="/atom.xml" target="_blank">
          <img src="https://blog.ooops.me/theme/images/rss-128.png" style="width:32px;">
        </a>
      </div>
      <div class="links">
        <a href="http://xlzd.me" target="_blank">xlzd杂谈</a>
        <a href="http://midday.me" target="_blank">正午的博客</a>
        <a href="http://mqhong.com" target="_blank">梦梦的咸鱼</a>
        <a href="http://bilibili.ooops.me" target="_blank">B站弹幕</a>
      </div>
      <div class="copyright">
        &copy <a href="/">Kosmgco</a>. <script>document.write(new Date().getFullYear());</script><br />
        Powered by <a href="https://getpelican.com" target="_blank">Pelican</a>. Theme by <a href="https://github.com/kosmgco/pelican-theme-mdshow" target="_blank">MDShow</a> 
        <br />
        <a href="https://www.miitbeian.gov.cn/" target="_blank">渝ICP备16003403号</a>
      </div>
    </div>
    <div class="catalog">
      <b>2018-12-26</b><a href="https://blog.ooops.me/posts/2018/12/26/sou-suo-yin-qing-jie-guo-zi-ding-yi-gui-ze-guo-lu-chromecha-jian.html">搜索引擎结果自定义规则过滤Chrome插件</a>
      <b>2018-12-18</b><a href="https://blog.ooops.me/posts/2018/12/18/mac-shadowsocks-duo-fu-wu-qi-shi-yong-haproxy-fu-zai-jun-heng-qi.html">Mac Shadowsocks 多服务器使用 HAProxy 负载均衡器</a>
      <b>2018-11-08</b><a href="https://blog.ooops.me/posts/2018/11/08/shi-yong-fail2ban-bao-hu-fu-wu-qi.html">使用 fail2ban 保护服务器</a>
      <b>2018-01-16</b><a href="https://blog.ooops.me/posts/2018/01/16/golang-json-zi-ding-yi-lei-xing-de-xu-lie-hua-yu-fan-xu-lie-hua.html">Golang JSON 自定义类型的序列化与反序列化</a>
      <b>2017-10-22</b><a href="https://blog.ooops.me/posts/2017/10/22/pai-xu-cha-ru-pai-xu.html">排序 - 插入排序</a>
      <b>2017-10-20</b><a href="https://blog.ooops.me/posts/2017/10/20/pai-xu-xuan-ze-pai-xu.html">排序 - 选择排序</a>
      <b>2017-09-21</b><a href="https://blog.ooops.me/posts/2017/09/21/golang-3des-des-aesjia-mi-jie-mi.html">Golang 3DES, DES, AES加密解密</a>
      <b>2017-09-16</b><a href="https://blog.ooops.me/posts/2017/09/16/zi-ji-shi-xian-shi-xian-yi-ge-zhan.html">自己实现实现一个栈</a>
      <b>2017-07-30</b><a href="https://blog.ooops.me/posts/2017/07/30/mysqlji-zhu-nei-mu-innodbcun-chu-yin-qing-di-yi-zhang.html">《MySQL技术内幕: InnoDB存储引擎》 - 第一章</a>
      <b>2017-07-08</b><a href="https://blog.ooops.me/posts/2017/07/08/nginxri-zhi-fen-xi.html">Nginx日志分析</a>
      <b>2017-02-24</b><a href="https://blog.ooops.me/posts/2017/02/24/tong-guo-ren-lian-shi-bie-huo-qu-xue-xiao-xue-sheng-de-xing-bie-bi-li.html">通过人脸识别获取学校学生的性别比例</a>
      <b>2016-12-10</b><a href="https://blog.ooops.me/posts/2016/12/10/kai-qi-quan-zhan-https.html">开启全站https</a>
      <b>2016-12-04</b><a href="https://blog.ooops.me/posts/2016/12/04/say-hello-world-to-docker.html">Say Hello-World! To Docker</a>
      <b>2016-10-25</b><a href="https://blog.ooops.me/posts/2016/10/25/ubuntu-gokai-fa-huan-jing-pei-zhi.html">Ubuntu-Go开发环境配置</a>
      <b>2016-07-19</b><a href="https://blog.ooops.me/posts/2016/07/19/shi-yong-python-flaskda-jian-qing-bo-ke.html">使用Python-Flask搭建轻博客</a>
      <b>2016-07-10</b><a href="https://blog.ooops.me/posts/2016/07/10/appfan-bian-yi.html">app反编译</a>
      <b>2016-07-10</b><a href="https://blog.ooops.me/posts/2016/07/10/gitcao-zuo.html">git操作</a>
      <b>2016-07-10</b><a href="https://blog.ooops.me/posts/2016/07/10/ubnntupei-zhi-shadowsockske-xue-shang-wang.html">Ubnntu配置shadowsocks科学上网</a>
      <b>2016-04-16</b><a href="https://blog.ooops.me/posts/2016/04/16/nginx-virtual-hostxu-ni-ji.html">nginx virtual host虚拟机</a>
      <b>2016-03-25</b><a href="https://blog.ooops.me/posts/2016/03/25/shi-xi-zong-jie.html">实习总结</a>
      <b>2016-03-04</b><a href="https://blog.ooops.me/posts/2016/03/04/wei-xin-gong-zhong-hao-yi-ji-zhi-neng-liao-tian-ji-qi-ren-de-jie-ru.html">微信公众号以及智能聊天机器人的接入</a>
      <b>2016-02-27</b><a href="https://blog.ooops.me/posts/2016/02/27/jia-su-le-cookie__jsl_clearnce-po-jie-xin-jin-zhan.html">加速乐cookie:__jsl_clearnce 破解新进展</a>
      <b>2016-02-23</b><a href="https://blog.ooops.me/posts/2016/02/23/fu-li-tie-shi-yong-ubermian-fei-zuo-zhuan-che.html">福利帖 - 使用uber免费坐专车</a>
      <b>2016-02-02</b><a href="https://blog.ooops.me/posts/2016/02/02/pycharmandroid-studioyuan-an-zhuang.html">Pycharm,Android-Studio源安装</a>
      <b>2016-01-17</b><a href="https://blog.ooops.me/posts/2016/01/17/pythonpa-qu-tu-pian.html">python爬取图片</a>
      <b>2016-01-10</b><a href="https://blog.ooops.me/posts/2016/01/10/zheng-fang-jiao-wu-xi-tong-shu-ju-huo-qu.html">正方教务系统数据获取</a>
      <b>2015-12-24</b><a href="https://blog.ooops.me/posts/2015/12/24/flask-wen-jian-jie-gou-zu-zhi.html">flask 文件结构组织</a>
      <b>2015-12-21</b><a href="https://blog.ooops.me/posts/2015/12/21/mongodb-xiao-dao-chu-shi.html">mongodb 小刀初试</a>
      <b>2015-12-20</b><a href="https://blog.ooops.me/posts/2015/12/20/guan-yu-shua-piao.html">关于刷票</a>
      <b>2015-12-18</b><a href="https://blog.ooops.me/posts/2015/12/18/python-jsonjie-xi-na-dian-shi.html">python json解析那点事</a>
      <b>2015-12-12</b><a href="https://blog.ooops.me/posts/2015/12/12/flask-chu-kui.html">flask 初窥</a>
      <b>2015-12-09</b><a href="https://blog.ooops.me/posts/2015/12/09/guan-yu-jia-su-le-de-__jsl_clearancefan-hui-521zhuang-tai-ma-po-jie.html">关于加速乐的__jsl_clearance返回521状态码破解</a>
    </div>
    <div class="content">
  <style>
    @media(max-width: 550px) {
      body {
        height: auto;
      }
      .menu .links, .menu .copyright {
        display:none;
      }
      .menu {
        height: 65%;
      }
      .catalog {
        display:none;
      }
      .content {
        display: block;
      }
      h3 {
        text-align: center;
      }
    }
  </style>
  <h3> 关于刷票 </h3>
    <a href="https://blog.ooops.me/tag/python.html" class="link-tags">python</a>
    <a href="https://blog.ooops.me/tag/tou-piao.html" class="link-tags">投票</a>
  <hr style="clear:both"/>
  <hr>
<h4>1.写在开头</h4>
<p>其实很早就想做一个刷票的东西了，因为之前还不会写网络爬虫而且微信投票还没兴起的时候，有很多人找我投票（学校的活动比较多→_→）。没办法，只能通过浏览器清除cookie之后再投票，这是一件非常重复的事情，lowb只能做这么low的事情了。。。</p>
<h4>2.浏览器抓包</h4>
<p>那么今天的网站呢是一个营销活动的网站：<strong>中国西部十大金融创新人物十佳金融创新企业</strong>http://www.zjxwcm.com/</p>
<p>在主页面就能看到很多的投票的选择，随便选择一个吧，到写这篇文章时的最后一个：田爽</p>
<p>投票是根据留言的多少来判断的，也就是说有多少留言就有多少票数，进入留言页面：<strong>候选人田爽</strong>http://www.zjxwcm.com/index.php?m=person&amp;o=main&amp;cid=1&amp;did=42。。。现在才3票，真可怜。。。
<img alt="Alt text" src="http://liyuan-t.xyz/images/Screenshot.png"></p>
<p>在浏览器中，按下F12进入开发者模式，切换到<code>Network</code>的<code>tab</code>页：
<img alt="Alt text" src="http://liyuan-t.xyz/images/Screenshot%20from%202015-12-20%2023:15:53.png">
现在什么都没有，那么我们现在来留一条言好了，留言完成会有一个<code>js</code>的<code>alert</code>出来，表示留言成功。那么点击留言按钮之后，浏览器究竟做了些什么呢？在网络页就能看到有两个请求：
<img alt="Alt text" src="http://liyuan-t.xyz/images/Screenshot%20from%202015-12-20%2023:19:00.png"></p>
<p>点击第一个请求，查看<code>headers</code>和<code>response</code>：
<img alt="Alt text" src="http://liyuan-t.xyz/images/Screenshot%20from%202015-12-20%2023:20:28.png">
发现在<code>Form Data</code>里面有我的留言信息，<code>response</code>是<code>o=o</code>，说明这个请求正是我们所需要的。而第二个请求是刷新验证码的，所以不用管。</p>
<p>那么我们构建表单<code>dict</code>如下：</p>
<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;m&#39;</span><span class="p">:</span><span class="s1">&#39;extend&#39;</span><span class="p">,</span>
    <span class="s1">&#39;o&#39;</span><span class="p">:</span><span class="s1">&#39;i&#39;</span><span class="p">,</span>
    <span class="s1">&#39;d&#39;</span><span class="p">:</span><span class="s1">&#39;message&#39;</span><span class="p">,</span>
    <span class="s1">&#39;typeid&#39;</span><span class="p">:</span><span class="s1">&#39;3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dataid&#39;</span><span class="p">:</span><span class="s1">&#39;42&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;dddd&#39;</span><span class="p">,</span>
    <span class="s1">&#39;email&#39;</span><span class="p">:</span><span class="s1">&#39;aaaa@bb.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;content&#39;</span><span class="p">:</span><span class="s1">&#39;加油加油，支持支持&#39;</span><span class="p">,</span>
    <span class="s1">&#39;codes&#39;</span><span class="p">:</span><span class="s1">&#39;zstz&#39;</span><span class="p">,</span>
    <span class="s1">&#39;_&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span>
<span class="p">}</span>
</pre></div>


<p>好了，这就是要通过post方式传过去的参数了。</p>
<h4>3.模拟人类</h4>
<p>但是这个<code>data</code>里面有<code>name</code>，<code>content</code>，<code>email</code>不能固定，不然太容易让人知道是刷票了，而在首页上写了：</p>
<blockquote>
<p>杜绝刷票等行为。</p>
</blockquote>
<p>所以我们还是要伪装的像一点。233333333333......</p>
<p>所以<code>name</code>字段我找了一个名字大全的网站，抓取了一些名字，做成一个<code>list</code>在这里就不详细写了，获取了<code>name</code>之后呢，还差<code>content</code>，傻傻的把之前的留言拷贝过来，做成一个<code>list</code>，将留言内容与名字随机组合：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="n">name_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">content_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">name_list</span><span class="p">)</span>
<span class="n">content</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">content_list</span><span class="p">)</span>
</pre></div>


<p>好了，名字和内容都有了，还有个<code>email</code>，这个当然更方便了，从26个英文字母随机抽几个加上<code>@qq.com</code>就变成QQ邮箱了。</p>
<p>恩。。快要完成了，还有一个参数：<code>codes</code>，这个就是验证码了。</p>
<p>先让<code>codes=''</code>试试：</p>
<p>带上参数，运行一次程序。返回<code>o=o</code>，这是什么意思。。。  当然是留言成功了！！</p>
<p>哈哈哈，这个网站很傻瓜，没有验证验证码是否正确，只要传了验证码这个参数就能通过验证。这是一个幸运的事。如果不能绕过只能使用<code>ocr</code>对验证码进行简单识别，当然还有更高级的开源库了。好吧，既然没有，那我也省事了。</p>
<p>优化一下代码结构，放到服务器上（自己电脑不可能一直开着让它跑吧），设置定时任务，每5分钟运行一次</p>
<h4>4.进阶</h4>
<p>由于服务器是固定ip地址，所以显示的全都是<code>来自某某地的网友XX对田爽说：。。。。</code></p>
<p>这也是能轻易分辨出来是在刷票了，那么有什么好的办法让它显示来自不同地方的呢？</p>
<p>最好的答案莫非是使用代理了。</p>
<p><code>python</code>的<code>requests</code>包可以很方便的使用代理：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">requests</span><span class="o">.</span><span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span><span class="s1">&#39;address&#39;</span><span class="p">}</span>
</pre></div>


<p>可以自己建立一个代理库，方便自己调用，每次运行程序的时候，自动调用代理，就不会一直显示同一个地址了。</p>
<p>至于代理的获取，可以从网上一些提供免费代理的网站上面爬下来，这里不再赘述。</p>
<p>翻滚吧，名次君！</p>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'https-blog-ooops-me';
      var disqus_identifier = window.location.href;
      (function () {
        var s = document.createElement('script'); s.async = true;
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//https-blog-ooops-me.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
  </script>
    </div>
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?67d2b3355046511d3ad9eef9c65d2a41";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();


  var hitokoto = document.getElementById('hitokoto');
  if (hitokoto) {
    var xhr = new XMLHttpRequest();
    xhr.open('get', 'https://v1.hitokoto.cn');
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
        var data = JSON.parse(xhr.responseText);
        hitokoto.innerText = data.hitokoto;
      }
    }
    xhr.send();
  }
    </script>
  </body>
</html>