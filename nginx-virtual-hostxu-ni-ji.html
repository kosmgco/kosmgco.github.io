<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>nginx virtual host虚拟机 | Kosmgco</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="category" value="back-end">
    <meta name="comment" value="true">
    <meta name="tags" value="nginx,服务器">
    <meta name="date" value="2016-04-16 00:00:00">
    <meta name="title" value="nginx virtual host虚拟机">
    <meta name="reader" value="markdown">
    <meta name="summary" value="一台服务器不止能放一个网站，但是在初期需要解决的是如何将所有网站的端口都映射到服务器的80端口，可以通过这样的方法访问同一个服务器上的不同网站">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="wb:webmaster" content="ba29596b8c7c7ae7" /> 

    <meta name="description" content="Linux. Python. Coder. Gopher.">
    <meta name="author" content="kosmgco">

    <link href="/theme/css/fonts.css" rel="stylesheet" />

    <link href="/theme/css/normalize.css" rel="stylesheet"/>
    <link href="/theme/css/skeleton.css" rel="stylesheet"/>
    <link href="/theme/css/github-prettify-theme.css" rel="stylesheet"/>
    <link href="/theme/css/custom.css" rel="stylesheet"/>
    <link href="/theme/css/pygments.css" rel="stylesheet"/>

    <script src="/theme/js/jquery.min.js"></script>
    <script src="/theme/js/run_prettify.js"></script>
    <script src="/theme/js/site.js"></script>
</head>
<body class="code-snippets-visible">

<div class="navbar-spacer"></div>
<nav class="navbar">
    <div class="container">
        <ul class="navbar-list">
            <li class="navbar-item">
                <a class="navbar-link" href="/">
                    HOME
                </a>
            </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/wiki.html">
                        wiki
                    </a>
                </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/about.html">
                        about
                    </a>
                </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/blog.html">
                        blog
                    </a>
                </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/theme.html">
                        theme
                    </a>
                </li>
                <li class="navbar-item">
                    <a class="navbar-link" href="/pages/books.html">
                        books
                    </a>
                </li>
        </ul>
        <div class="navbar-link">
            <a href="/"><img src="/theme/images/header.jpg" class="site-icon"/></a>
        </div>
    </div>
</nav>
<div class="container">
    <section id="content">
        <article>
            <p class="article-date">
                全文总字数: 586
            </p>
            <header class="article-header">
                <a href="/nginx-virtual-hostxu-ni-ji.html" rel="bookmark" title="Permalink to nginx virtual host虚拟机">
                    <h3 class="blogpost-title">
                        nginx virtual host虚拟机
                    </h3>
                </a>
            </header>
            <div>
                <p>一台服务器不止能放一个网站，但是在初期需要解决的是如何将所有网站的端口都映射到服务器的80端口，可以通过这样的方法访问同一个服务器上的不同网站:http://blog.ooops.me，也可以这样访问: http://blog.ooops.me:801，但是带个端口号终归是不好看的，能不能这样做成在一台服务器上放两个网站:a，b。通过域名的方式访问:http://a.ooops.me,http://b.ooops.me。</p>
<p>服务器环境:</p>
<p>Server: nginx/1.4.6</p>
<p>OS: Ubuntu 14.04 LTS</p>
<p>User: root</p>
<p>IP: 123.123.123.123</p>
<h4>1.安装nginx服务器</h4>
<div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get install nginx
</pre></div>


<h4>2.创建网站数据文件夹</h4>
<div class="highlight"><pre><span></span># site1
mkdir /var/www/public/html/a

# site2
mkdir /var/www/public/html/b
</pre></div>


<h4>3.设置权限与所有者</h4>
<div class="highlight"><pre><span></span>chown -R www-data:www-data /var/www/public/html/a
chown -R www-data:www-data /var/www/public/html/b

chmod -R 755 /var/www/public/html/a
chmod -R 755 /var/www/public/html/b
</pre></div>


<h4>4.设置DNS记录</h4>
<p>在域名服务商的管理控制台中新增两个A记录</p>
<table>
<thead>
<tr>
<th>记录类型</th>
<th>主机记录</th>
<th>记录值</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>a</td>
<td>123.123.123.123</td>
</tr>
<tr>
<td>B</td>
<td>b</td>
<td>123.123.123.123</td>
</tr>
</tbody>
</table>
<h4>5.创建测试页面</h4>
<div class="highlight"><pre><span></span>echo &quot;<span class="nt">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span>a.ooops.me<span class="nt">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;</span>This is a.ooops.me<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>&quot; &gt; /var/www/public/html/a/index.html

echo &quot;<span class="nt">&lt;html&gt;&lt;head&gt;&lt;title&gt;</span>b.ooops.me<span class="nt">&lt;/title&gt;&lt;/head&gt;&lt;body&gt;</span>This is b.ooops.me<span class="nt">&lt;/body&gt;&lt;/html&gt;</span>&quot; &gt; /var/www/public/html/b/index.html
</pre></div>


<h4>6.创建服务器配置文件</h4>
<div class="highlight"><pre><span></span>cp /etc/nginx/site-available/default /etc/nginx/site-available/a
cp /etc/nginx/site-available/default /etc/nginx/site-available/b
</pre></div>


<h4>7.修改配置文件</h4>
<p><code>/etc/nginx/site-available/default</code>的内容为:
已删除被注释掉的内容</p>
<div class="highlight"><pre><span></span>server {
        listen 80 default_server;
        listen [::]:80 default_server ipv6only=on;

        root /usr/share/nginx/html;
        index index.html index.htm;

        server_name localhost;

        location / {
                try_files $uri $uri/ =404;
        }
}
</pre></div>


<p><code>/etc/nginx/site-available/a</code>的内容修改为:</p>
<div class="highlight"><pre><span></span>server {
        listen 80;
#       listen [::]:80 default_server ipv6only=on;

        root /var/www/a.com/public_html;
        index index.html index.htm;

        server_name a.ooops.me;

        location / {
                try_files $uri $uri/ =404;
        }
}
</pre></div>


<p><code>/etc/nginx/site-available/b</code>的内容修改为:</p>
<div class="highlight"><pre><span></span>server {
        listen 80 ;
#       listen [::]:80 default_server ipv6only=on;

        root /var/www/b.com/public_html;
        index index.html index.htm;

        server_name b.ooops.me;

        location / {
                try_files $uri $uri/ =404;
        }
}
</pre></div>


<p>都是注释掉第三行，将第二行的<code>default_server</code>删掉，将第八行的服务器名称改为相应的域名。</p>
<h4>8. 创建软连接</h4>
<div class="highlight"><pre><span></span>ln -s /etc/nginx/site-available/a /etc/nginx/site-enabled/a
ln -s /etc/nginx/site-available/b /etc/nginx/site-enabled/b
</pre></div>


<h4>9.重启服务器</h4>
<div class="highlight"><pre><span></span>service nginx restart
</pre></div>


<h4>10.访问</h4>
<p>在浏览器输入域名<code>http://a.ooops.me</code>，<code>http://b.ooops.me</code>。就能分别看到不同的内容了。</p>
<p>同理，还能增加更多的虚拟机</p>
            </div>
            <div class="article-info">
                <hr/>
                <div class="article-info">
                    <span><b>Category: </b><a href="/category/back-end.html">back-end</a></span>
                    <br/>
                    <span><b>Publication Date: </b> Sat 16 April 2016 </span>
                    <br/>
                        <a class="label-default" href="/tag/nginx.html">nginx</a>
                        <a class="label-default" href="/tag/fu-wu-qi.html">服务器</a>
                    <br/>
                </div>
            </div>
        </article>
    </section>
    <br/>
    <br/>
    <br/>
</div>

<footer class="footer">
    &copy <a href="/" >kosmgco</a>. 2016
    <br/>
    Powered by <a href="//getpelican.com/">pelican</a>.
    Theme by <a href="//github.com/kosmgco/ops">ops</a> | 
    <a href="//www.miitbeian.gov.cn/">渝ICP备16003403号</a>
</footer>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?67d2b3355046511d3ad9eef9c65d2a41";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
    })();
</script>
</body>
</html>