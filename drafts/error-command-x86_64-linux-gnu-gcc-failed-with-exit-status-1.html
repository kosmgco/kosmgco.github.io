<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>  Kosmgco | error: command 'x86_64-linux-gnu-gcc' failed with exit status 1 </title>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<link href="https://blog.ooops.me/theme/css/github-markdown.css" rel="stylesheet"/>
<link href="https://blog.ooops.me/theme/css/custom.css" rel="stylesheet"/>
<meta name="baidu-site-verification" content="qfSD7JIuUr"/>
<meta name="description" content="Linux. Python. Coder. Gopher."/>
<meta name="author" content="kosmgco" />

<meta name="viewport" content="width=device-width, initaial-scale=1"/>  </head>
  <body class="markdown-body">
    <style>
      @media (max-width: 550px) {
        .catalog, .content {
          display:none;
        }
      }
    </style>
    <div class="menu">
      <div class="title" style="background: url(https://static.ooops.me/md-upload-1536468495519.png) no-repeat; background-position: center"></div>
      <h3> Kosmgco </h3>
      <h4> Linux. Python. Coder. Gopher. </h4>
      <div class="links-menu" >
        <a href="https://blog.ooops.me/" class="menu-link" title="HOME"><img src="/theme/images/home.png" width="40"/></a>
        <a href="https://blog.ooops.me/tags.html" class="menu-link" title="TAGS"><img src="/theme/images/tags.png" width="40"/></a>
        <a href="https://blog.ooops.me/categories.html" class="menu-link" title="CATEGORIES"><img src="/theme/images/categories.png" width="40"/></a>
        <a href="https://blog.ooops.me/pages/about.html" class="menu-link" title="ABOUT"><img src="/theme/images/about.png" width="40"/></a>
        <a href="https://blog.ooops.me/pages/blog.html" class="menu-link" title="BLOG"><img src="/theme/images/blog.png" width="40"/></a>
        <a href="https://blog.ooops.me/pages/wiki.html" class="menu-link" title="WIKI"><img src="/theme/images/wiki.png" width="40"/></a>
 
      </div>
      <div class="links">
        <a href="http://github.com/kosmgco" target="_blank">
          <img src="https://blog.ooops.me/theme/images/github-128.png" style="width:32px;">
        </a>
        <a href="mailto:i@ooops.me" target="_blank">
          <img src="https://blog.ooops.me/theme/images/mail-128.png" style="width:32px;">
        </a>
        <a href="/atom.xml" target="_blank">
          <img src="https://blog.ooops.me/theme/images/rss-128.png" style="width:32px;">
        </a>
      </div>
      <div class="links">
        <a href="http://xlzd.me" target="_blank">xlzd杂谈</a>
        <a href="http://midday.me" target="_blank">正午的博客</a>
        <a href="http://mqhong.com" target="_blank">梦梦的咸鱼</a>
        <a href="http://bilibili.ooops.me" target="_blank">B站弹幕</a>
      </div>
      <div class="copyright">
        &copy <a href="/">Kosmgco</a>. <script>document.write(new Date().getFullYear());</script><br />
        Powered by <a href="https://getpelican.com" target="_blank">Pelican</a>. Theme by <a href="https://github.com/kosmgco/pelican-theme-mdshow" target="_blank">MDShow</a> 
        <br />
        <a href="https://www.miitbeian.gov.cn/" target="_blank">渝ICP备16003403号</a>
      </div>
    </div>
    <div class="catalog">
      <b>2018-12-26</b><a href="https://blog.ooops.me/posts/2018/12/26/sou-suo-yin-qing-jie-guo-zi-ding-yi-gui-ze-guo-lu-chromecha-jian.html">搜索引擎结果自定义规则过滤Chrome插件</a>
      <b>2018-12-18</b><a href="https://blog.ooops.me/posts/2018/12/18/mac-shadowsocks-duo-fu-wu-qi-shi-yong-haproxy-fu-zai-jun-heng-qi.html">Mac Shadowsocks 多服务器使用 HAProxy 负载均衡器</a>
      <b>2018-11-08</b><a href="https://blog.ooops.me/posts/2018/11/08/shi-yong-fail2ban-bao-hu-fu-wu-qi.html">使用 fail2ban 保护服务器</a>
      <b>2018-01-16</b><a href="https://blog.ooops.me/posts/2018/01/16/golang-json-zi-ding-yi-lei-xing-de-xu-lie-hua-yu-fan-xu-lie-hua.html">Golang JSON 自定义类型的序列化与反序列化</a>
      <b>2017-10-22</b><a href="https://blog.ooops.me/posts/2017/10/22/pai-xu-cha-ru-pai-xu.html">排序 - 插入排序</a>
      <b>2017-10-20</b><a href="https://blog.ooops.me/posts/2017/10/20/pai-xu-xuan-ze-pai-xu.html">排序 - 选择排序</a>
      <b>2017-09-21</b><a href="https://blog.ooops.me/posts/2017/09/21/golang-3des-des-aesjia-mi-jie-mi.html">Golang 3DES, DES, AES加密解密</a>
      <b>2017-09-16</b><a href="https://blog.ooops.me/posts/2017/09/16/zi-ji-shi-xian-shi-xian-yi-ge-zhan.html">自己实现实现一个栈</a>
      <b>2017-07-30</b><a href="https://blog.ooops.me/posts/2017/07/30/mysqlji-zhu-nei-mu-innodbcun-chu-yin-qing-di-yi-zhang.html">《MySQL技术内幕: InnoDB存储引擎》 - 第一章</a>
      <b>2017-07-08</b><a href="https://blog.ooops.me/posts/2017/07/08/nginxri-zhi-fen-xi.html">Nginx日志分析</a>
      <b>2017-02-24</b><a href="https://blog.ooops.me/posts/2017/02/24/tong-guo-ren-lian-shi-bie-huo-qu-xue-xiao-xue-sheng-de-xing-bie-bi-li.html">通过人脸识别获取学校学生的性别比例</a>
      <b>2016-12-10</b><a href="https://blog.ooops.me/posts/2016/12/10/kai-qi-quan-zhan-https.html">开启全站https</a>
      <b>2016-12-04</b><a href="https://blog.ooops.me/posts/2016/12/04/say-hello-world-to-docker.html">Say Hello-World! To Docker</a>
      <b>2016-10-25</b><a href="https://blog.ooops.me/posts/2016/10/25/ubuntu-gokai-fa-huan-jing-pei-zhi.html">Ubuntu-Go开发环境配置</a>
      <b>2016-07-19</b><a href="https://blog.ooops.me/posts/2016/07/19/shi-yong-python-flaskda-jian-qing-bo-ke.html">使用Python-Flask搭建轻博客</a>
      <b>2016-07-10</b><a href="https://blog.ooops.me/posts/2016/07/10/appfan-bian-yi.html">app反编译</a>
      <b>2016-07-10</b><a href="https://blog.ooops.me/posts/2016/07/10/gitcao-zuo.html">git操作</a>
      <b>2016-07-10</b><a href="https://blog.ooops.me/posts/2016/07/10/ubnntupei-zhi-shadowsockske-xue-shang-wang.html">Ubnntu配置shadowsocks科学上网</a>
      <b>2016-04-16</b><a href="https://blog.ooops.me/posts/2016/04/16/nginx-virtual-hostxu-ni-ji.html">nginx virtual host虚拟机</a>
      <b>2016-03-25</b><a href="https://blog.ooops.me/posts/2016/03/25/shi-xi-zong-jie.html">实习总结</a>
      <b>2016-03-04</b><a href="https://blog.ooops.me/posts/2016/03/04/wei-xin-gong-zhong-hao-yi-ji-zhi-neng-liao-tian-ji-qi-ren-de-jie-ru.html">微信公众号以及智能聊天机器人的接入</a>
      <b>2016-02-27</b><a href="https://blog.ooops.me/posts/2016/02/27/jia-su-le-cookie__jsl_clearnce-po-jie-xin-jin-zhan.html">加速乐cookie:__jsl_clearnce 破解新进展</a>
      <b>2016-02-23</b><a href="https://blog.ooops.me/posts/2016/02/23/fu-li-tie-shi-yong-ubermian-fei-zuo-zhuan-che.html">福利帖 - 使用uber免费坐专车</a>
      <b>2016-02-02</b><a href="https://blog.ooops.me/posts/2016/02/02/pycharmandroid-studioyuan-an-zhuang.html">Pycharm,Android-Studio源安装</a>
      <b>2016-01-17</b><a href="https://blog.ooops.me/posts/2016/01/17/pythonpa-qu-tu-pian.html">python爬取图片</a>
      <b>2016-01-10</b><a href="https://blog.ooops.me/posts/2016/01/10/zheng-fang-jiao-wu-xi-tong-shu-ju-huo-qu.html">正方教务系统数据获取</a>
      <b>2015-12-24</b><a href="https://blog.ooops.me/posts/2015/12/24/flask-wen-jian-jie-gou-zu-zhi.html">flask 文件结构组织</a>
      <b>2015-12-21</b><a href="https://blog.ooops.me/posts/2015/12/21/mongodb-xiao-dao-chu-shi.html">mongodb 小刀初试</a>
      <b>2015-12-20</b><a href="https://blog.ooops.me/posts/2015/12/20/guan-yu-shua-piao.html">关于刷票</a>
      <b>2015-12-18</b><a href="https://blog.ooops.me/posts/2015/12/18/python-jsonjie-xi-na-dian-shi.html">python json解析那点事</a>
      <b>2015-12-12</b><a href="https://blog.ooops.me/posts/2015/12/12/flask-chu-kui.html">flask 初窥</a>
      <b>2015-12-09</b><a href="https://blog.ooops.me/posts/2015/12/09/guan-yu-jia-su-le-de-__jsl_clearancefan-hui-521zhuang-tai-ma-po-jie.html">关于加速乐的__jsl_clearance返回521状态码破解</a>
    </div>
    <div class="content">
  <style>
    @media(max-width: 550px) {
      body {
        height: auto;
      }
      .menu .links, .menu .copyright {
        display:none;
      }
      .menu {
        height: 65%;
      }
      .catalog {
        display:none;
      }
      .content {
        display: block;
      }
      h3 {
        text-align: center;
      }
    }
  </style>
  <h3> error: command 'x86_64-linux-gnu-gcc' failed with exit status 1 </h3>
    <a href="https://blog.ooops.me/tag/ubuntu.html" class="link-tags">ubuntu</a>
    <a href="https://blog.ooops.me/tag/gcc.html" class="link-tags">gcc</a>
  <hr style="clear:both"/>
  <p>起因:</p>
<div class="highlight"><pre><span></span>sudo pip install psycopg2
</pre></div>


<p>err info:</p>
<div class="highlight"><pre><span></span><span class="n">error</span><span class="o">:</span> <span class="n">command</span> <span class="s1">&#39;x86_64-linux-gnu-gcc&#39;</span> <span class="n">failed</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">status</span> <span class="mi">1</span>
</pre></div>


<p>solution:</p>
<div class="highlight"><pre><span></span>sudo apt-get install python-dev
</pre></div>


<p>python pip修改安装源为阿里云源</p>
<p>mkdir ~/.pip &amp;&amp; cd ~/.pip
   echo -e "[global] \ntrusted-host=mirrors.aliyun.com \nindex-url=http://mirrors.aliyun.com/pypi/simple/" &gt;&gt; pip.conf</p>
<p>Linux crontab with pytesseract</p>
<p>在使用 <code>Linux cron</code> 设置定时任务，并且使用 <code>pytesseract</code> 作为验证码识别库时，会出现找不到 <code>*.traineddata</code> ，但是使用 <code>python cron_with_pytesseract.py</code> 可以正常运行。一般来说， <code>*.traineddata</code> 是放在 <code>/usr/local/share/pytess/</code> 下面的。使用定时任务报的错为 <code>No Such file or directory</code> 。</p>
<p>解决方案:
使用python的 <code>apscheduler</code> 库作为定时任务启动工具。</p>
<p>from apscheduler.schedulers.background import BlockingScheduler
   scheduler = BlockingScheduler()
   scheduler.add_job(main, 'cron', day='*', hour='03', minute='05', second='0' )
   scheduler.start()</p>
<p>Ubuntu中设置python环境变量</p>
<p>有时候在服务器中运行会出现找不到 <code>module</code> 的错误，最简单直接的方法就是在文件中添加以下两行代码就可以</p>
<p>import sys
   sys.path.append(path)</p>
<p>但是当文件太多，而且每个都需要添加的时候就有点麻烦了，直接添加系统环境变量是一个方法</p>
<p>sudo echo -e "export PYTHONPATH=$PYTHONPATH:/usr/app/python/path/" &gt;&gt; .bashrc
   source .bashrc</p>
<p>这样就能愉快的使用 <code>/usr/app/python/path/</code> 下面的模块了。</p>
<p>如果只是单个用户使用这台服务器当然没什么问题了，但是当多人使用的时候，就可能把别人的环境搞坏。所以还是推荐使用 <code>virtualenv</code></p>
<p>virtualenv venv
   cd venv
   source bin/active</p>
<p>python自动发微博</p>
<p>#!/usr/bin/env python
   #-<em>-coding=utf-8-</em>-</p>
<p>import base64
   import re
   import requests
   import urllib
   import binascii
   import random
   from bs4 import BeautifulSoup
   import rsa
   import time
   import traceback
   import json
   import md5
   import datetime
   import sys
   reload(sys)
   sys.setdefaultencoding('utf-8')</p>
<p>req = requests.Session()
   headers = {
       'Accept':'<em>/</em>',
       'Accept-Encoding':'gzip, deflate, sdch',
       'Accept-Language':'en-US,en;q=0.8',
       'Cache-Control':'max-age=0',
       'Connection':'keep-alive',
       'Host':'weibo.com',
       'Upgrade-Insecure-Requests':1,
       'User-Agent':'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36'
   }
   req.headers['Referer'] = 'http://weibo.com'
   req.headers['User-Agent'] = 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.86 Safari/537.36'</p>
<p>def login_weibo(username,password):
       try:
           prelogin_url = 'http://login.sina.com.cn/sso/prelogin.php?entry=weibo&amp;callback=sinaSSOController.preloginCal' \
                          'lBack&amp;su=%s&amp;rsakt=mod&amp;checkpin=1&amp;client=ssologin.js(v1.4.18)&amp;_=1447731207967' % username
           pre_login_data = req.get(prelogin_url,allow_redirects=False).content
           servertime = re.findall('"servertime":(.<em>?),', pre_login_data)[0]
           pubkey = re.findall('"pubkey":"(.</em>?)",', pre_login_data)[0]
           rsakv = re.findall('"rsakv":"(.<em>?)",', pre_login_data)[0]
           nonce = re.findall('"nonce":"(.</em>?)",', pre_login_data)[0]
           su = base64.b64encode(bytes(urllib.quote(username)))
           rsa_publickey = int(pubkey, 16)
           key = rsa.PublicKey(rsa_publickey, 65537)
           message = bytes(str(servertime) + '\t' + str(nonce) + '\n' + str(password))
           sp = binascii.b2a_hex(rsa.encrypt(message, key))
           param = {
               'entry': 'weibo',
               'gateway': 1,
               'from': '',
               'savestate': 7,
               'useticket': 1,
               'pagerefer': 'http://login.sina.com.cn/sso/logout.php?entry=miniblog&amp;r=http%3A%2F%2Fweibo.com%2Flogout.php%3Fbackurl%3D',
               'vsnf': 1,
               'su': su,
               'service': 'miniblog',
               'servertime': servertime,
               'nonce': nonce,
               'pwencode': 'rsa2',
               'rsakv': rsakv,
               'sp': sp,
               'sr': '1680*1050',
               'encoding': 'UTF-8',
               'prelt': 441,
               'url': 'http://weibo.com/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack',
               'returntype':'META'
           }
           data = urllib.urlencode(param).encode('utf-8')
           req.headers['Content-Type'] = 'application/x-www-form-urlencoded'
           res = req.post('http://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.4.18)',data)
           urll = re.findall("location.replace(<a href=".*?">\'\"</a>[\'\"]);", res.content)[0]
           print urll
           res = req.get(urll)
           req.headers.update({'Referer':'http://login.sina.com.cn/sso/login.php?client=ssologin.js(v1.4.18)'})
           req.get('http://weibo.com/ajaxlogin.php?framelogin=1&amp;callback=parent.sinaSSOController.feedBackUrlCallBack&amp;sudaref=weibo.com')
           return True
       except Exception,e:
           traceback.print_exc()
           return False</p>
<p>def send_text(text):
       url = 'http://weibo.com/aj/mblog/add?ajwvr=6&amp;__rnd=%s'%int(time.time()*1000)
       print url
       data = {
           'location':'v6_content_home',
           'appkey':'',
           'style_type':'1',
           'pic_id':'',
           'text':text,
           'pdetail':'',
           'rank':'0',
           'rankid':'',
           'module':'stissue',
           'pub_source':'main_',
           'pub_type':'dialog',
           '_t':'0'
       }
       data = urllib.urlencode(data).encode('utf-8')
       req.headers['Content-Type'] = 'application/x-www-form-urlencoded'
       req.headers['Referer'] = 'http://weibo.com/liyuantgg/home?wvr=5&amp;lf=reg'
       res = req.post(url,data)
   #    print res.content
       return</p>
<p>def web_service():
       rand = int(random.uniform(0,20))
       url = 'http://lengxiaohua.com/random'
       res = req.get(url)
       soup = BeautifulSoup(res.content,'html5lib')
       div = soup.find_all('div',{'class':'para_can'})
       if div:
           if div[rand].find('div',{'class':'joke_img_box clearfix'}) == None:</p>
<div class="highlight"><pre><span></span>           return_info = div[rand].find(&#39;pre&#39;,{&#39;js&#39;:&#39;joke_summary&#39;}).get_text().encode(&#39;utf-8&#39;)
           return return_info 
       else:
           web_service()
   else:
           web_service()

if __name__ == &#39;__main__&#39;:
    if login_weibo(&#39;phone&#39;,&#39;password&#39;):
        text =web_service()
        send_text(text)
    else:
        print &#39;login failed&#39;
</pre></div>


<p>retrying模块的使用</p>
<h3>install</h3>
<div class="highlight"><pre><span></span>pip install retrying
</pre></div>


<h3>usage</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">retrying</span> <span class="kn">import</span> <span class="n">retry</span>

<span class="nd">@retry</span>
<span class="k">def</span> <span class="nf">case1</span><span class="p">():</span>
    <span class="k">pass</span>


<span class="nd">@retry</span><span class="p">(</span><span class="n">wait_random_min</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">wait_random_max</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case2</span><span class="p">():</span>
    <span class="k">pass</span>


<span class="nd">@retry</span><span class="p">(</span><span class="n">stop_max_attempt_number</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">case3</span><span class="p">():</span>
    <span class="k">pass</span>
</pre></div>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
      var disqus_shortname = 'https-blog-ooops-me';
      var disqus_identifier = window.location.href;
      (function () {
        var s = document.createElement('script'); s.async = true;
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//https-blog-ooops-me.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }());
  </script>
    </div>
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?67d2b3355046511d3ad9eef9c65d2a41";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();


  var hitokoto = document.getElementById('hitokoto');
  if (hitokoto) {
    var xhr = new XMLHttpRequest();
    xhr.open('get', 'https://v1.hitokoto.cn');
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
        var data = JSON.parse(xhr.responseText);
        hitokoto.innerText = data.hitokoto;
      }
    }
    xhr.send();
  }
    </script>
  </body>
</html>